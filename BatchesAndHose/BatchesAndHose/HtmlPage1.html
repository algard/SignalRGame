<!DOCTYPE html>
<html>
<head>
    <title>SignalR Simple Chat</title>
    <style type="text/css">
        body {
            background-color: #666;
        }

        .Chatcontainer {
            background-color: #9CF;
            border: thick solid #888;
            padding: 20px;
            width: 20%;
            float: right;
        }

        .canvas {
            width: 800px;
            height: 800px;
            padding: 20px;
            border: 5px solid #000;
            display: inline-block;
        }

        .player {
            width: 75px;
            height: 75px;
            position: absolute;
            top: 50px;
            left: 500px;
            border: 2px solid #000;
            background-color: #060;
            border-radius: 10px;
        }
        
        #playerDetails {
            display: block;
            padding: 5px;
        }

        .playerName {
            border: 1px solid #000000;
            margin-left: 10px;
        }

        #displayname {
            border: 1px solid #000;
            background-color: #666;
            border: 1px solid #000;
        }

        ul {
            list-style: none;
        }
    </style>
</head>
    <body>
        
        <div id="playerDetails">
            <label for="displayname">Player Name:</label><input name="displayname" id="displayname" />
        </div>
    
        <div class="canvas"></div>

        <div class="Chatcontainer">
            <input type="text" id="message" />
            <input type="button" id="sendmessage" value="Send" />
            <ul id="discussion">
            </ul>
        </div>


        <!--Script references. -->
        <!--Reference the jQuery library. -->
        <script src="Scripts/jquery-1.9.0.min.js" ></script>
        <!--Reference the SignalR library. -->
        <script src="Scripts/jquery.signalR-1.0.0-rc2.js"></script>
        <!--Reference the autogenerated SignalR hub script. -->
        <script src="/signalr/hubs"></script>
        <!--Add script to update the page and send messages.--> 
        <script type="text/javascript">
            $(function () {
                // Declare a proxy to reference the hub. 
                var chat = $.connection.chatHub;

                /*
                 * broadcastMessage - recieve a message from another player
                 */
                chat.client.broadcastMessage = function (name, message) {
                    // Html encode display name and message. 
                    var encodedName = $('<div />').text(name).html();
                    var encodedMsg = $('<div />').text(message).html();
                    // Add the message to the page. 
                    $('#discussion').append('<li><strong>' + encodedName
                        + '</strong>:&nbsp;&nbsp;' + encodedMsg + '</li>');
                };

                /*
                 * movePlayer - notify the client that a player has moved
                 */
                chat.client.movePlayer = function (name, x, y) {
                    $('#player' + name).css('top', y);
                    $('#player' + name).css('left', x);
                };

                /*
                 * addPlayer - notify the client that a player has been added to the game
                 */
                chat.client.addPlayer = function (newPlayerName, x, y) {
                    // if (newPlayerName == $('#displayname').val()) {
                    //     return;
                    // }

                    var playerDiv = $('<div />', {
                        id: 'player' + newPlayerName,
                        "class": 'player'
                    });

                    var name = $('<span />', {
                        "class": 'playerName'
                    }).text(newPlayerName);

                    playerDiv.append(name);
                    playerDiv.css('top', y + 'px');
                    playerDiv.css('left', x + 'px');

                    $("body").append(playerDiv);
                };


                /*
                 * init code
                 */
                // Get the user name and store it to prepend to messages.
                var playerName = prompt('Enter your name:', '');
                $('#displayname').val(playerName);
                // Set initial focus to message input box.  
                $('#message').focus();
                // Start the connection.
                $.connection.hub.start().done(function () {
                    chat.server.addNewPlayer($('#displayname').val());
                    $('#sendmessage').click(function () {
                        // Call the Send method on the hub. 
                        chat.server.send($('#displayname').val(), $('#message').val());


                        // Clear text box and reset focus for next comment. 
                        $('#message').val('').focus();
                    });
                });
            });
        </script>
    </body>
</html>
